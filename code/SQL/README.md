
<!-------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------->

# Introduction

This repository contains the scripts used for the CCU002-04 project
(to compare the long-term risk of stroke/MI in patients after
coronavirus infection with other respiratory infections).

-   Generated by: Hoda Abbasizanjani
    (<Hoda.Abbasizanjani@swansea.ac.uk>)

<!-------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------->

# Method

To generate data for WMCC projects in the SAIL Databank, a four-layer
process has been implemented in order to maximise data reusability and
reproducibility, starting from raw data in Layer 1, followed by curated
data in Layer 2, phenotyped data in Layer 3, and finally
project-specific data in Layer 4. Multiple demographic and electronic
health record (EHR) data sources have been used, including primary and
secondary care-related data sources, prescribing and dispensing records,
COVID-19 testing and vaccination data, and mortality records. The data
sources contributed varied follow-up time, which covered the years
1990-2022. See ‘’Harmonising electronic health records for reproducible
research: challenges, solutions and recommendations from a UK-wide
COVID-19 research collaboration’’
(<https://doi.org/10.21203/rs.3.rs-2109276/v1>) for more details.

<!-------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------->

## Layer 1 (raw data sources)

Layer 1 consists of raw EHRs in SAIL, which are available to all
approved users conducting CVD-COVID-UK projects in a “read-only”
database schema (`SAILWMCCV` schema). Some of raw EHRs used for this
project are:

-   (PATD) Pathology data COVID-19 Daily
-   (PEDW) Patient Episode Database for Wales
-   (WDSD) Welsh Demographic Service Dataset
-   (WLGP) Wales Longitudinal General Practice
-   (OPDW) Outpatient Dataset for Wales
-   (EDDS) Emergency Department Data Set
-   (WDDS) Welsh Dispensing Dataset
-   (WRRS) Welsh Results Reporting Service
-   (ICNC) ICNARC - Intensive Care National Audit & Research Centre
-   (ICCD) ICNARC - Intensive Care National Audit & Research Centre
    (COVID only admissions)
-   (CVVD) COVID-19 Vaccine Data

For information on these original SAIL data sources please see the HDR
innovation gateway.

*Remark: The SAIL Databank only contains anonymised information, since
the actual date of birth of an individual is deemed as sensitive and
potentially identifiable information. It has been agreed that the date
of birth is masked by SAIL to the Monday of the week of birth (i.e., the
Monday that occurs prior to the actual date of birth). Hence all age
calculations will be accurate to +/- 7 days.*

<!-------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------->

## Layer 2 (curated data)

There are two types of data tables in Layer 2. Firstly, general purpose,
pre-prepared, cleaned tables with derived columns known as Research
Ready Data Assets (RRDAs) which are generated by applying quality
checks, linkage, and pre-processing procedures on the raw data sources.
The RRDAs are maintained by the Population Data Science group at Swansea
University and made available for several projects including
CVD-COVID-UK.

An example of RRDAs is the ‘COVID-19 C19\_COHORT20 e-cohort’
(`SAILWMCCV.C19_COHORT20`) which includes all Welsh residents, alive and
living in Wales on the 1st January 2020, with follow up through multiple
data sources until end 2023 (data to be updated as it becomes
available). This RRDA also includes all Welsh residents who have moved
into Wales or born after 1st January 2020. Another example of RRDAs is
the ‘COVID-19 C19\_COHORT16 e-cohort’ (`SAILWMCCV.C19_COHORT16`) which
includes all Welsh residents, alive and living in Wales on the 1st
January 2016, with follow up through multiple data sources until 31st
December 2019.

The RRDAs available in the `SAILWMCCV` schema are as follows:

-   COVID-19 C19\_COHORT20 e-cohort:
    -   `SAILWMCCV.C19_COHORT20`
-   COVID-19 C19\_COHORT16 e-cohort:
    -   `SAILWMCCV.C19_COHORT16`
-   C19\_COHORT20 mortality e-cohort (combined mortality data):
    -   `SAILWMCCV.C19_COHORT20_MORTALITY`
-   C19\_COHORT16 mortality e-cohort (combined mortality data):
    -   `SAILWMCCV.C19_COHORT16_MORTALITY`
-   Drug Dispensing e-cohort:
    -   `SAILWMCCV.C19_COHORT20_RRDA_WDDS`
-   COVID-19 derived vaccination:
    -   `SAILWMCCV.C19_COHORT20_RRDA_CVVD`

In addition to the RRDAs in Layer 2, a curated version of other raw data
sources (called ‘WMCC’ tables) has been generated (in `SAILWWMCCV`
schema) by linking them to the C20 cohort (and for some cases, also to
the C16 cohort) and applying some pre-processing procedures. List of
Layer 2 WMCC tables are as follows:

-   PATD:
    -   `SAILWWMCCV.WMCC_PATD_DF_COVID_LIMS_ANTIBODYRESULTS`
    -   `SAILWWMCCV.WMCC_PATD_DF_COVID_LIMS_TESTRESULTS`
-   PEDW:
    -   `SAILWWMCCV.WMCC_PEDW_EPISODE`
    -   `SAILWWMCCV.WMCC_PEDW_DIAG`
    -   `SAILWWMCCV.WMCC_PEDW_OPER`
    -   `SAILWWMCCV.WMCC_PEDW_SPELL`
    -   `SAILWWMCCV.WMCC_PEDW_SUPERSPELL`
-   WDSD:
    -   `SAILWWMCCV.WMCC_WDSD_AR_PERS_ADD`
    -   `SAILWWMCCV.WMCC_WDSD_AR_PERS_GP`
-   WLGP:
    -   `SAILWWMCCV.WMCC_WLGP_GP_EVENT`
    -   `SAILWWMCCV.WMCC_WLGP_PATIENT_ALF_CLEANSED`
-   OPDW:
    -   `SAILWWMCCV.WMCC_OPDW_OUTPATIENTS`
    -   `SAILWWMCCV.WMCC_OPDW_OUTPATIENTS_DIAG`
    -   `SAILWWMCCV.WMCC_OPDW_OUTPATIENTS_OPER`
-   ICNC:
    -   `SAILWWMCCV.WMCC_ICNC_ICNARC_LINKAGE_ALF`
    -   `SAILWWMCCV.WMCC_ICNC_ICNARC_LINKAGE`
-   COVID-19 related death registration info:
    -   `SAILWWMCCV.WMCC_DEATH_COVID19`

<!-------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------->

## Layer 3 (phenotyped data)

Layer 3 consists of phenotype-related data tables, called
`SAILWWMCCV.PHEN_DataSourceName_PhenotypeName`. These include all
records related to a phenotype or group of phenotypes within a data
table in Layer 2. Examples of Layer 3 data tables are
`PHEN_PEDW_COVID19` (which includes all confirmed or suspected cases of
COVID-19 in the curated version of PEDW data in Layer 2), and
`PHEN_PEDW_CVD` (which contain all records related to cardiovascular
diseases in the curated version of PEDW). This layer also includes
generated phenotype look-up tables, called
`SAILWWMCCV.PHEN_ClinicalCoding_PhenotypeName`. For example,
`SAILWWMCCV.PHEN_ICD10_COVID19` is the list of ICD-10 codes for COVID-19
phenotype. The phenotypes for hospital and mortality data are coded in
ICD-10, while phenotypes based on primary care data uses Read codes.
Also medication related phenotypes for dispensing data are coded in BNF,
and hospital interventions and procedures are defined based on OPCS-4
procedure codes. Generated phenotyped data are a follows:

-   `SAILWWMCCV.PHEN_PATD_TESTRESULTS_COVID19`
-   `SAILWWMCCV.PHEN_PEDW_COVID19`
-   `SAILWWMCCV.PHEN_WLGP_COVID19`
-   `SAILWWMCCV.PHEN_PEDW_RESPIRATORY_INFECTIONS`
-   `SAILWWMCCV.PHEN_WLGP_RESPIRATORY_INFECTIONS`
-   `SAILWWMCCV.PHEN_WRRS_RESPIRATORY_INFECTIONS`
-   `SAILWWMCCV.PHEN_DEATH_CVD`
-   `SAILWWMCCV.PHEN_PEDW_CVD`
-   `SAILWWMCCV.PHEN_OPDW_CVD`
-   `SAILWWMCCV.PHEN_WLGP_CVD`
-   `SAILWWMCCV.PHEN_WDDS_COVARIATES`
-   `SAILWWMCCV.PHEN_PEDW_COVARIATES`
-   `SAILWWMCCV.PHEN_WLGP_COVARIATES`

<!-------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------->

## Layer 4 (project-specific data tables)

Finally in Layer 4, project-specific data tables are created. The
following list describes data tables created (in `SAILWWMCCV` schema)
for both CCU002-04 analyses (COVID-19 infection analysis and
non-COVID-19 respiratory infection analysis). Tables whose name starts
with `CCU002_04_COVID` include records for individuals eligible for
COVID-19 infection analysis, while tables whose name starts with
`CCU002_04_FLU_COHORT` are created for the eligible population for the
non-COVID-19 respiratory infection analysis.

<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 21%" />
<col style="width: 26%" />
<col style="width: 17%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Table name (in <code>SAILWWMCCV</code>
schema)</th>
<th style="text-align: left;">COVID analysis</th>
<th style="text-align: left;">Non-COVID analysis</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Data sources</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td
style="text-align: left;"><code>CCU002_04_INCLUDED_PATIENTS</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">List of eligible individuals for COVID or
non-COVID analysis</td>
<td style="text-align: left;"><code>SAILWMCCV.C19_COHORT20</code>,
<code>SAILWMCCV.C19_COHORT16</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CCU002_04_COVID19_ALL</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">COVID-19 exposure (all record related to a
positive COVID-19 PCR test, or diagnosis of COVID-19 in primary or
secondary care data)</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWWMCCV.PHEN_PATD_TESTRESULTS_COVID19</code>,
<code>SAILWWMCCV.PHEN_WLGP_COVID19</code>,
<code>SAILWWMCCV.PHEN_PEDW_COVID19</code>,
<code>SAILWWMCCV.WMCC_ICNC_ICNARC_LINKAGE</code>,
<code>SAILWMCCV.C19_COHORT_ICCD_ICNARC_LINKAGE</code></td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>CCU002_04_COVID19_HOSPITALISATION</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">COVID-19 hospitalisation status</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_COVID19_ALL</code></td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>CCU002_04_COVID_COHORT_CVD_OUTCOMES_ALL</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">CVD outcomes (all records related to a CVD
condition in primary or secondary care data or death data)</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWWMCCV.PHEN_DEATH_CVD</code>,
<code>SAILWWMCCV.PHEN_PEDW_CVD</code>,
<code>SAILWWMCCV.PHEN_WLGP_CVD</code></td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>CCU002_04_COVID_COHORT_CVD_OUTCOMES_FIRST</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">First event for each CVD outcome within
the study period</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_COVID_COHORT_CVD_OUTCOMES_ALL</code></td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>CCU002_04_COVID_COHORT_CVD_OUTCOMES_FIRST_COMPOSITE</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">First event for each combined CVD
outcome</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_COVID_COHORT_CVD_OUTCOMES_ALL</code></td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>CCU002_04_COVID_COHORT_COVARIATES</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Covariates</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWMCCV.C19_COHORT20_RRDA_WDDS</code>,
<code>SAILWWMCCV.WMCC_PEDW_DIAG</code>,
<code>SAILWWMCCV.PHEN_WDDS_COVARIATES</code>,
<code>SAILWWMCCV.PHEN_WLGP_COVARIATES</code>,
<code>SAILWWMCCV.PHEN_PEDW_COVARIATES</code>,
<code>SAILWWMCCV.WMCC_PEDW_OPER</code>,
<code>SAILWWMCCV.CCU002_04_FLU_PNEUMONIA_ALL</code>,
<code>SAILWWMCCV.WMCC_WLGP_GP_EVENT_CLEANSED</code>,
<code>SAILWWMCCV.PHEN_PEDW_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.WMCC_ICNC_ICNARC_LINKAGE</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CCU002_04_COVID_COHORT</code></td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Final cohort for COVID analysis</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWWMCCV.CCU002_04_COVID_COHORT_COVARIATES</code>,
<code>SAILWWMCCV.WMCC_COMB_ETHN_EHRD</code>,
<code>SAILWWMCCV.CCU002_04_COVID19_HOSPITALISATION</code>,
<code>SAILWWMCCV.CCU002_04_COVID_COHORT_CVD_OUTCOMES_FIRST</code>,
<code>SAILWWMCCV.PHEN_WLGP_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.PHEN_PEDW_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.PHEN_WRRS_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.WMCC_ICNC_ICNARC_LINKAGE</code></td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>CCU002_04_FLU_PNEUMONIA_ALL</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">Influenza and pneumonia exposure (all
record related to a positive influenza or pneumonia PCR test, or
diagnosis of influenza or pneumonia in primary or secondary care
data)</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWWMCCV.PHEN_WRRS_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.PHEN_PEDW_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.PHEN_WLGP_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.WMCC_ICNC_ICNARC_LINKAGE</code></td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>CCU002_04_FLU_PNEUMONIA_HOSPITALISATION</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">Influenza and pneumonia hospitalisation
status</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_FLU_PNEUMONIA_ALL</code></td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>CCU002_04_FLU_COHORT_CVD_OUTCOMES_ALL</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">CVD outcomes (all records related to a CVD
condition in primary or secondary care data or death data)</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWWMCCV.PHEN_DEATH_CVD</code>,
<code>SAILWWMCCV.PHEN_PEDW_CVD</code>,
<code>SAILWWMCCV.PHEN_WLGP_CVD</code></td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>CCU002_04_FLU_COHORT_CVD_OUTCOMES_FIRST</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">First event for each CVD outcome within
the study period</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_FLU_COHORT_CVD_OUTCOMES_ALL</code></td>
</tr>
<tr class="odd">
<td
style="text-align: left;"><code>CCU002_04_FLU_COHORT_CVD_OUTCOMES_FIRST_COMPOSITE</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">First event for each combined CVD
outcome</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_FLU_COHORT_CVD_OUTCOMES_ALL</code></td>
</tr>
<tr class="even">
<td
style="text-align: left;"><code>CCU002_04_FLU_COHORT_COVARIATES</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">Covariates</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWMCCV.C19_COHORT20_RRDA_WDDS</code>,
<code>SAILWWMCCV.WMCC_PEDW_DIAG</code>,
<code>SAILWWMCCV.PHEN_WDDS_COVARIATES</code>,
<code>SAILWWMCCV.PHEN_WLGP_COVARIATES</code>,
<code>SAILWWMCCV.PHEN_PEDW_COVARIATES</code>,
<code>SAILWWMCCV.WMCC_PEDW_OPER</code>,
<code>SAILWWMCCV.PHEN_PEDW_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.WMCC_ICNC_ICNARC_LINKAGE</code>,
<code>SAILWWMCCV.PHEN_WLGP_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.PHEN_WRRS_RESPIRATORY_INFECTIONS</code>,
<code>SAILWWMCCV.WMCC_WLGP_GP_EVENT_CLEANSED</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>CCU002_04_FLU_COHORT</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">✔</td>
<td style="text-align: left;">Final cohort for non-COVID analysis</td>
<td
style="text-align: left;"><code>SAILWWMCCV.CCU002_04_INCLUDED_PATIENTS</code>,
<code>SAILWWMCCV.CCU002_04_FLU_COHORT_COVARIATES</code>,
<code>SAILWWMCCV.WMCC_COMB_ETHN_EHRD</code>,
<code>SAILWWMCCV.CCU002_04_FLU_PNEUMONIA_ALL</code>,
<code>SAILWWMCCV.CCU002_04_FLU_PNEUMONIA_HOSPITALISATION</code>,
<code>SAILWWMCCV.CCU002_04_FLU_COHORT_CVD_OUTCOMES_FIRST</code></td>
</tr>
</tbody>
</table>
